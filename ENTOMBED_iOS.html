<!DOCTYPE html>
<html>
<head>
<title> ENTOMBED </title>
</head>
<body style = "overflow: hidden" onload="play()">
<style>
html {width:100%; height:100%; overflow:hidden;}
</style>
<canvas id="imgCanvas" width="420" height="420" style="position: absolute; top: 30px; left: 100px; z-index: 0; border: 0px solid black;"></canvas>
<canvas id="hddnCanvas" width="420" height="420" style="position: absolute; top: 30px; left: 100px; z-index: 1; border: 0px solid black;"></canvas>
<canvas id="bkgrndCanvas" width="420" height="420" style="position: absolute; top: 30px; left: 100px; z-index: 2; border: 0px solid black;"></canvas>
<canvas id="trpsCanvas" width="420" height="420" style="position: absolute; top: 30px; left: 100px; z-index: 3; border: 0px solid black;"></canvas>
<canvas id="plyrCanvas" width="420" height="420" style="position: absolute; top: 30px; left: 100px; z-index: 4; border: 0px solid black;"></canvas>
<canvas id="mnstrCanvas" width="420" height="420" style="position: absolute; top: 30px; left: 100px; z-index: 5; border: 0px solid black;"></canvas>
<canvas id="shdwCanvas" width="420" height="420" style="position: absolute; top: 30px; left: 100px; z-index: 6; border: 0px solid black;"></canvas>
<canvas id="txtCanvas" width="420" height="420" style="position: absolute; top: 30px; left: 100px; z-index: 7; border: 0px solid black;"></canvas>
<script>

var imageCanvas = document.getElementById("imgCanvas");
var imageContext = imageCanvas.getContext("2d");
var hiddenCanvas = document.getElementById("hddnCanvas");
var hiddenContext = hiddenCanvas.getContext("2d");
var backgroundCanvas = document.getElementById("bkgrndCanvas");
var backgroundContext = backgroundCanvas.getContext("2d");
var trapsCanvas = document.getElementById("trpsCanvas");
var trapsContext = trapsCanvas.getContext("2d");
var playerCanvas = document.getElementById("plyrCanvas");
var playerContext = playerCanvas.getContext("2d");
var monsterCanvas = document.getElementById("mnstrCanvas");
var monsterContext = monsterCanvas.getContext("2d");
var shadowCanvas = document.getElementById("shdwCanvas");
var shadowContext = shadowCanvas.getContext("2d");
var textCanvas = document.getElementById("txtCanvas");
var textContext = textCanvas.getContext("2d");
var canvasWidth = backgroundCanvas.width;
var canvasHeight = backgroundCanvas.height;

var numberOfPixelsPerCanvas = 21;
var pixelWidth = Math.round(canvasWidth/numberOfPixelsPerCanvas);
var pixelHeight = Math.round(canvasHeight/numberOfPixelsPerCanvas);
var numberOfPixelsInGrid = 2*numberOfPixelsPerCanvas;
var numberOfTraps = 30;
var numberOfMonsters = 10;
var numberOfMonsterFrames = 5;
var minimumNumberOfTiles = Math.round(0.7*numberOfPixelsInGrid*numberOfPixelsInGrid);
var tileOpacity = 0.3;

var grid;
var checkedGrid;

var playerI, playerJ, playerDirection;
var monsterDirection = new Array(numberOfMonsters);
var monsterI = new Array(numberOfMonsters);
var monsterJ = new Array(numberOfMonsters);

var isWalking = 0;
var keyReleased = 1;
var lastkeycode;
var couldIGetAKeyInEdgewise = 0;
var monsterIsAsleep = new Array(numberOfMonsters);
var monsterWalkIndex = new Array(numberOfMonsters);
var playerWalkIndex = 0;
var monsterIsAlive = new Array(numberOfMonsters);
var monsterTimer = 90;
var playerTimer = 40;

var blankSpaceWidth = Math.round((canvasWidth-pixelWidth)/2);
var blankSpaceHeight = Math.round((canvasHeight-pixelHeight)/2);
var mazeImage = new Image(numberOfPixelsInGrid*pixelWidth+2*blankSpaceWidth,numberOfPixelsInGrid*pixelHeight+2*blankSpaceHeight);
var trapsImage = new Image(mazeImage.width,mazeImage.height);
var ballImage = new Image(pixelWidth,pixelHeight);
var monsterImages = new Array(4);
var spiderWalkImages = [new Image(pixelWidth,pixelHeight),new Image(pixelWidth,pixelHeight),new Image(pixelWidth,pixelHeight),new Image(pixelWidth,pixelHeight)];
var restingSpiderImage = new Image(pixelWidth,pixelHeight);
var tileImages = [new Image(pixelWidth,pixelHeight),new Image(pixelWidth,pixelHeight),new Image(pixelWidth,pixelHeight),new Image(pixelWidth,pixelHeight),new Image(pixelWidth,pixelHeight),new Image(pixelWidth,pixelHeight),new Image(pixelWidth,pixelHeight)];
var liftedTileImages = [new Image(pixelWidth,pixelHeight),new Image(pixelWidth,pixelHeight),new Image(pixelWidth,pixelHeight),new Image(pixelWidth,pixelHeight),new Image(pixelWidth,pixelHeight),new Image(pixelWidth,pixelHeight),new Image(pixelWidth,pixelHeight)];
var shadowImage = new Image(numberOfPixelsInGrid*pixelWidth+2*blankSpaceWidth,numberOfPixelsInGrid*pixelHeight+2*blankSpaceHeight);
var gameOver = 0;
var monsterSightRadius = 5;

function isPlayerVisible(i,j)
{
	var deltaI = playerI - i;
	var deltaJ = playerJ - j;
	var rSquared = deltaI*deltaI + deltaJ*deltaJ;
	if (rSquared > monsterSightRadius*monsterSightRadius) {return 0;}
	var rSquared2, theta, theta1, theta2, theta3, theta4, minTheta, maxTheta, startI, startJ, endI, endJ;
	theta = Math.atan2(deltaJ,deltaI);
	if (theta < 0) {theta += 2*Math.PI;}
	startI = i - monsterSightRadius;
	if (startI < 0) {startI = 0;}
	startJ = j - monsterSightRadius;
	if (startJ < 0) {startJ = 0;}
	endI = i + monsterSightRadius;
	if (endI >= grid.length) {endI = grid.length-1;}
	endJ = j + monsterSightRadius;
	if (endJ >= grid[startI].length) {endJ = grid[startI].length-1;}
	for (var m = startI; m <= endI; m++)
	{
		for (var n = startJ; n <= endJ; n++)
		{
			if (grid[m][n] == -1)
			{
				deltaI = m-i;
				deltaJ = n-j;
				rSquared2 = deltaI*deltaI + deltaJ*deltaJ;
				if (rSquared2 < rSquared)
				{
					theta1 = Math.atan2(deltaJ+0.5,deltaI-0.5);
					if (theta1 < 0) {theta1 += 2*Math.PI;}
					theta2 = Math.atan2(deltaJ+0.5,deltaI+0.5);
					if (theta2 < 0) {theta2 += 2*Math.PI;}
					theta3 = Math.atan2(deltaJ-0.5,deltaI-0.5);
					if (theta3 < 0) {theta3 += 2*Math.PI;}
					theta4 = Math.atan2(deltaJ-0.5,deltaI+0.5);
					if (theta4 < 0) {theta4 += 2*Math.PI;}
					minTheta = theta1;
					maxTheta = theta1;
					if (minTheta > theta2) {minTheta = theta2;}
					if (maxTheta < theta2) {maxTheta = theta2;}
					if (minTheta > theta3) {minTheta = theta3;}
					if (maxTheta < theta3) {maxTheta = theta3;}
					if (minTheta > theta4) {minTheta = theta4;}
					if (maxTheta < theta4) {maxTheta = theta4;}
					if (maxTheta - minTheta > Math.PI)
					{
						maxTheta -= 2*Math.PI;
						if (theta > Math.PI)
						{
							theta -= 2*Math.PI;
						}
						if (theta >= maxTheta && theta <= minTheta) {return 0;}
						if (theta < 0)
						{
							theta += 2*Math.PI;
						}
					}
					if (minTheta <= theta && maxTheta >= theta) {return 0;}
				}
			}
		}
	}
	return 1;
}

function monsterWalk(monsterIndex,currentI,currentJ,nextI,nextJ,frame)
{
	if (frame > 4)
	{
		monsterWalkIndex[monsterIndex] = frame-1;
		monsterI[monsterIndex] = nextI;
		monsterJ[monsterIndex] = nextJ;
		if (grid[monsterI[monsterIndex]][monsterJ[monsterIndex]] == -2)
		{
			monsterIsAlive[monsterIndex] = 0;
			renderMaze();
		}
		checkIfMonsterSeesPlayer(monsterIndex);
		return;
	} else {
		monsterWalkIndex[monsterIndex] = frame-1;
		monsterI[monsterIndex] = (nextI - currentI)*frame/4 + currentI;
		monsterJ[monsterIndex] = (nextJ - currentJ)*frame/4 + currentJ;
		renderMaze();
		(function(mI,cI,cJ,nI,nJ,f) {
			setTimeout( function() {
				monsterWalk(mI,cI,cJ,nI,nJ,f+1);
			}, monsterTimer);
		})(monsterIndex,currentI,currentJ,nextI,nextJ,frame);
		return;
	}
}

function monsterNextMove(monsterIndex)
{
	var deltaI = playerI - monsterI[monsterIndex];
	var deltaJ = playerJ - monsterJ[monsterIndex];
	var nextI = monsterI[monsterIndex];
	var nextJ = monsterJ[monsterIndex];
	var nextDirection = monsterDirection[monsterIndex];
	if (deltaI == 0 && deltaJ == 0)
	{
		gameOverSequence();
		return;
	}
	if (Math.abs(deltaI) > Math.abs(deltaJ))
	{
		if (deltaI < 0)
		{
			nextDirection = 0;
			nextI--;
		} else {
			nextDirection = 1;
			nextI++;
		}
	} else {
		if (deltaJ < 0)
		{
			nextDirection = 2;
			nextJ--;
		} else {
			nextDirection = 3;
			nextJ++;
		}
	}
	if (nextI < 0 || nextI >= grid.length) {return;}
	if (nextJ < 0 || nextJ >= grid[nextI].length) {return;}
	if (grid[nextI][nextJ] != -1)
	{
		monsterDirection[monsterIndex] = nextDirection;
		monsterWalk(monsterIndex,monsterI[monsterIndex],monsterJ[monsterIndex],nextI,nextJ,1);
	} else {
		nextI = monsterI[monsterIndex];
		nextJ = monsterJ[monsterIndex];
		nextDirection = monsterDirection[monsterIndex];
		if (Math.abs(deltaI) < Math.abs(deltaJ))
		{
			if (deltaI < 0)
			{
				nextDirection = 0;
				nextI--;
			} else {
				nextDirection = 1;
				nextI++;
			}
		} else {
			if (deltaJ < 0)
			{
				nextDirection = 2;
				nextJ--;
			} else {
				nextDirection = 3;
				nextJ++;
			}
			if (nextI < 0 || nextI >= grid.length) {return;}
			if (nextJ < 0 || nextJ >= grid[nextI].length) {return;}
			if (grid[nextI][nextJ] != -1)
			{
				monsterDirection[monsterIndex] = nextDirection;
				monsterWalk(monsterIndex,monsterI[monsterIndex],monsterJ[monsterIndex],nextI,nextJ,1);
			} else {
				checkIfMonsterSeesPlayer(monsterIndex);
			}
		}
	}
	return;
}

function checkIfMonsterSeesPlayer(monsterIndex)
{
	if (!monsterIsAlive[monsterIndex]) {return;}
	monsterI[monsterIndex] = Math.round(monsterI[monsterIndex]);
	monsterJ[monsterIndex] = Math.round(monsterJ[monsterIndex]);
	if (gameOver) {return;}
	if (monsterIsAsleep[monsterIndex] && isPlayerVisible(monsterI[monsterIndex],monsterJ[monsterIndex]))
	{
		monsterIsAsleep[monsterIndex] = 0;
		monsterNextMove(monsterIndex);
		renderMaze();
		return;
	}
	if (!monsterIsAsleep[monsterIndex])
	{
		if (!isPlayerVisible(monsterI[monsterIndex],monsterJ[monsterIndex]))
		{
			monsterIsAsleep[monsterIndex] = 1;
			(function(index) {
				setTimeout(function() {
					checkIfMonsterSeesPlayer(index);
				},100);
			})(monsterIndex);
			renderMaze();
			return;
		} else {
			monsterNextMove(monsterIndex);
			return;
		}
	}
	(function(index) {
		setTimeout(function() {
			checkIfMonsterSeesPlayer(index);
		},100);
	})(monsterIndex);
	return;
}

function renderMaze()
{
	playerContext.clearRect(0,0,canvasWidth,canvasHeight);
	if (isWalking) {
		playerContext.drawImage(ballImage,blankSpaceWidth,blankSpaceHeight);
	} else {
		playerContext.drawImage(ballImage,blankSpaceWidth,blankSpaceHeight);
	}
	backgroundContext.clearRect(0,0,canvasWidth,canvasHeight);
	backgroundContext.drawImage(mazeImage,playerI*pixelWidth,playerJ*pixelHeight,canvasWidth,canvasHeight,0,0,canvasWidth,canvasHeight);
	trapsContext.clearRect(0,0,canvasWidth,canvasHeight);
	trapsContext.drawImage(trapsImage,playerI*pixelWidth,playerJ*pixelHeight,canvasWidth,canvasHeight,0,0,canvasWidth,canvasHeight);
	shadowContext.clearRect(0,0,canvasWidth,canvasHeight);
	shadowContext.drawImage(shadowImage,playerI*pixelWidth,playerJ*pixelHeight,canvasWidth,canvasHeight,0,0,canvasWidth,canvasHeight);
	monsterContext.clearRect(0,0,canvasWidth,canvasHeight);
	var test = 1;
	for (var i = 0; i < numberOfMonsters; i++)
	{
		if (monsterIsAlive[i])
		{
			monsterContext.drawImage(monsterImages[monsterDirection[i]][monsterWalkIndex[i]],(monsterI[i]-playerI)*pixelWidth+Math.round((canvasWidth-pixelWidth)/2),(monsterJ[i]-playerJ)*pixelHeight+Math.round((canvasHeight-pixelHeight)/2));
			test = 0;
		}
	}
	if (test) {victorySequence();}
	return;
}

function drawRestingSpider()
{
	imageCanvas.width = pixelWidth;
	imageCanvas.height = pixelHeight;
	imageContext.fillStyle = "black";
	imageContext.beginPath();
	imageContext.arc(10,15,3,0,2*Math.PI);
	imageContext.closePath();
	imageContext.fill();
	imageContext.beginPath();
	imageContext.arc(10,11,2,0,2*Math.PI);
	imageContext.closePath();
	imageContext.fill();
	imageContext.strokeStyle = "black";
	imageContext.moveTo(11,9);
	imageContext.lineTo(13,7);
	imageContext.lineTo(12,2);
	imageContext.stroke();
	imageContext.moveTo(11,10);
	imageContext.lineTo(16,9);
	imageContext.lineTo(18,3);
	imageContext.stroke();
	imageContext.moveTo(11,13);
	imageContext.lineTo(14,14);
	imageContext.lineTo(15,19);
	imageContext.stroke();
	imageContext.moveTo(11,12);
	imageContext.lineTo(16,13);
	imageContext.lineTo(18,19);
	imageContext.stroke();
	imageContext.moveTo(9,9);
	imageContext.lineTo(7,7);
	imageContext.lineTo(8,2);
	imageContext.stroke();
	imageContext.moveTo(9,10);
	imageContext.lineTo(4,9);
	imageContext.lineTo(2,3);
	imageContext.stroke();
	imageContext.moveTo(9,13);
	imageContext.lineTo(6,14);
	imageContext.lineTo(5,19);
	imageContext.stroke();
	imageContext.moveTo(9,12);
	imageContext.lineTo(4,13);
	imageContext.lineTo(2,19);
	imageContext.stroke();
	restingSpiderImage.src = imageCanvas.toDataURL("image/png");
	restingSpiderImage.onload = function() {
		drawMonsterImages(0,0);
	}
	return;
}

function drawSpiderWalk4()
{
	imageCanvas.width = pixelWidth;
	imageCanvas.height = pixelHeight;
	imageContext.fillStyle = "black";
	imageContext.beginPath();
	imageContext.arc(10,15,3,0,2*Math.PI);
	imageContext.closePath();
	imageContext.fill();
	imageContext.beginPath();
	imageContext.arc(10,11,2,0,2*Math.PI);
	imageContext.closePath();
	imageContext.fill();
	imageContext.strokeStyle = "black";
	imageContext.moveTo(9,9);
	imageContext.lineTo(7,7);
	imageContext.lineTo(7,4);
	imageContext.stroke();
	imageContext.moveTo(11,9);
	imageContext.lineTo(13,8);
	imageContext.lineTo(13,3);
	imageContext.stroke();
	imageContext.moveTo(9,10);
	imageContext.lineTo(15,10);
	imageContext.lineTo(16,6);
	imageContext.stroke();
	imageContext.moveTo(11,10);
	imageContext.lineTo(5,10);
	imageContext.lineTo(4,6);
	imageContext.stroke();
	imageContext.moveTo(11,11);
	imageContext.lineTo(15,13);
	imageContext.lineTo(16,16);
	imageContext.stroke();
	imageContext.moveTo(9,11);
	imageContext.lineTo(5,12);
	imageContext.lineTo(4,17);
	imageContext.stroke();
	imageContext.moveTo(9,12);
	imageContext.lineTo(6,15);
	imageContext.lineTo(5,19);
	imageContext.stroke();
	imageContext.moveTo(11,12);
	imageContext.lineTo(13,14);
	imageContext.lineTo(15,18);
	imageContext.stroke();
	spiderWalkImages[3].src = imageCanvas.toDataURL("image/png");
	spiderWalkImages[3].onload = drawRestingSpider;
	return;
}

function drawSpiderWalk3()
{
	imageCanvas.width = pixelWidth;
	imageCanvas.height = pixelHeight;
	imageContext.fillStyle = "black";
	imageContext.beginPath();
	imageContext.arc(10,15,3,0,2*Math.PI);
	imageContext.closePath();
	imageContext.fill();
	imageContext.beginPath();
	imageContext.arc(10,11,2,0,2*Math.PI);
	imageContext.closePath();
	imageContext.fill();
	imageContext.strokeStyle = "black";
	imageContext.moveTo(9,9);
	imageContext.lineTo(7,7);
	imageContext.lineTo(6,2);
	imageContext.stroke();
	imageContext.moveTo(11,9);
	imageContext.lineTo(13,8);
	imageContext.lineTo(12,5);
	imageContext.stroke();
	imageContext.moveTo(9,10);
	imageContext.lineTo(5,11);
	imageContext.lineTo(3,8);
	imageContext.stroke();
	imageContext.moveTo(11,10);
	imageContext.lineTo(15,9);
	imageContext.lineTo(16,4);
	imageContext.stroke();
	imageContext.moveTo(11,11);
	imageContext.lineTo(15,13);
	imageContext.lineTo(16,18);
	imageContext.stroke();
	imageContext.moveTo(9,11);
	imageContext.lineTo(5,12);
	imageContext.lineTo(4,15);
	imageContext.stroke();
	imageContext.moveTo(9,12);
	imageContext.lineTo(6,14);
	imageContext.lineTo(4,19);
	imageContext.stroke();
	imageContext.moveTo(11,12);
	imageContext.lineTo(13,15);
	imageContext.lineTo(14,18);
	imageContext.stroke();
	spiderWalkImages[2].src = imageCanvas.toDataURL("image/png");
	spiderWalkImages[2].onload = drawSpiderWalk4;
	return;
}

function drawSpiderWalk2()
{
	imageCanvas.width = pixelWidth;
	imageCanvas.height = pixelHeight;
	imageContext.fillStyle = "black";
	imageContext.beginPath();
	imageContext.arc(10,15,3,0,2*Math.PI);
	imageContext.closePath();
	imageContext.fill();
	imageContext.beginPath();
	imageContext.arc(10,11,2,0,2*Math.PI);
	imageContext.closePath();
	imageContext.fill();
	imageContext.strokeStyle = "black";
	imageContext.moveTo(11,9);
	imageContext.lineTo(13,7);
	imageContext.lineTo(13,4);
	imageContext.stroke();
	imageContext.moveTo(9,9);
	imageContext.lineTo(7,8);
	imageContext.lineTo(7,3);
	imageContext.stroke();
	imageContext.moveTo(11,10);
	imageContext.lineTo(15,10);
	imageContext.lineTo(16,6);
	imageContext.stroke();
	imageContext.moveTo(9,10);
	imageContext.lineTo(5,10);
	imageContext.lineTo(4,6);
	imageContext.stroke();
	imageContext.moveTo(9,11);
	imageContext.lineTo(5,13);
	imageContext.lineTo(4,16);
	imageContext.stroke();
	imageContext.moveTo(11,11);
	imageContext.lineTo(15,12);
	imageContext.lineTo(16,17);
	imageContext.stroke();
	imageContext.moveTo(11,12);
	imageContext.lineTo(14,15);
	imageContext.lineTo(15,19);
	imageContext.stroke();
	imageContext.moveTo(9,12);
	imageContext.lineTo(7,14);
	imageContext.lineTo(5,18);
	imageContext.stroke();
	spiderWalkImages[1].src = imageCanvas.toDataURL("image/png");
	spiderWalkImages[1].onload = drawSpiderWalk3;
	return;
}

function drawSpiderWalk1()
{
	hiddenCanvas.width = pixelWidth;
	hiddenCanvas.height = pixelHeight;
	hiddenContext.fillStyle = "white";
	hiddenContext.fillRect(0,0,pixelWidth,pixelHeight);
	imageCanvas.width = pixelWidth;
	imageCanvas.height = pixelHeight;
	imageContext.fillStyle = "black";
	imageContext.beginPath();
	imageContext.arc(10,15,3,0,2*Math.PI);
	imageContext.closePath();
	imageContext.fill();
	imageContext.beginPath();
	imageContext.arc(10,11,2,0,2*Math.PI);
	imageContext.closePath();
	imageContext.fill();
	imageContext.strokeStyle = "black";
	imageContext.moveTo(11,9);
	imageContext.lineTo(13,7);
	imageContext.lineTo(14,2);
	imageContext.stroke();
	imageContext.moveTo(9,9);
	imageContext.lineTo(7,8);
	imageContext.lineTo(8,5);
	imageContext.stroke();
	imageContext.moveTo(11,10);
	imageContext.lineTo(15,11);
	imageContext.lineTo(16,8);
	imageContext.stroke();
	imageContext.moveTo(9,10);
	imageContext.lineTo(5,9);
	imageContext.lineTo(4,4);
	imageContext.stroke();
	imageContext.moveTo(9,11);
	imageContext.lineTo(5,13);
	imageContext.lineTo(4,18);
	imageContext.stroke();
	imageContext.moveTo(11,11);
	imageContext.lineTo(15,12);
	imageContext.lineTo(16,15);
	imageContext.stroke();
	imageContext.moveTo(11,12);
	imageContext.lineTo(14,14);
	imageContext.lineTo(16,19);
	imageContext.stroke();
	imageContext.moveTo(9,12);
	imageContext.lineTo(7,15);
	imageContext.lineTo(6,18);
	imageContext.stroke();
	spiderWalkImages[0].src = imageCanvas.toDataURL("image/png");
	spiderWalkImages[0].onload = drawSpiderWalk2;
	return;
}

function drawMonsterImages(index,direction)
{
	if (direction > 3)
	{
		drawMonsterImages(index+1,0);
		return;
	}
	if (index >= numberOfMonsterFrames)
	{
		//drawPlayerImages(0);
		imageCanvas.width = 0;
		imageCanvas.height = 0;
		hiddenCanvas.width = 0;
		hiddenCanvas.height = 0;
		for (var i = 0; i < numberOfMonsters; i++)
		{
			(function(index) {
				setTimeout(function() {
					checkIfMonsterSeesPlayer(index);
				},100);})(i);
		}
		renderMaze();
		/*
		document.onkeydown = function(e) {
			arrowKey(e.keyCode);
		};
		document.onkeyup = function(e) {
			if (e.keyCode == lastkeycode) {keyReleased = 1;}
		};
		*/
		if (window.DeviceOrientationEvent)
		{
			window.addEventListener("deviceorientation", function(event) {
				tiltHandler(event.beta,event.gamma);
			}, true);
		} else {
			alert("No gyroscope detected.");
		}
		return;
	}
	hiddenCanvas.width = pixelWidth;
	hiddenCanvas.height = pixelHeight;
	hiddenContext.fillStyle = "white";
	hiddenContext.fillRect(0,0,pixelWidth,pixelHeight);
	imageCanvas.width = pixelWidth;
	imageCanvas.height = pixelHeight;
	var theta;
	switch (direction)
	{
		case 0:
			theta = -Math.PI/2;
			break;
		case 1:
			theta = Math.PI/2;
			break;
		case 2:
			theta = 0;
			break;
		case 3:
			theta = Math.PI;
			break;
	}
	imageContext.save();
	imageContext.translate(Math.round(pixelWidth/2),Math.round(pixelHeight/2));
	imageContext.rotate(theta);
	imageContext.translate(-Math.round(pixelWidth/2),-Math.round(pixelHeight/2));
	if (index < numberOfMonsterFrames-1)
	{
		imageContext.drawImage(spiderWalkImages[index],0,0);
	} else {
		imageContext.drawImage(restingSpiderImage,0,0);
	}
	imageContext.restore();
	monsterImages[direction][index].src = imageCanvas.toDataURL("image/png");
	monsterImages[direction][index].onload = function() {
		imageCanvas.width = 0;
		imageCanvas.height = 0;
		hiddenCanvas.width = 0;
		hiddenCanvas.height = 0;
		drawMonsterImages(index,direction+1);
	}
	return;
}

function drawTrapsImage()
{
	imageCanvas.width = trapsImage.width;
	imageCanvas.height = trapsImage.height;
	imageContext.strokeStyle = "black";
	imageContext.fillStyle = "black";
	var x, y;
	for (var i = 0; i < grid.length; i++)
	{
		for (var j = 0; j < grid[i].length; j++)
		{
			if (grid[i][j] == -2)
			{
				x = i*pixelWidth + blankSpaceWidth;
				y = j*pixelHeight + blankSpaceHeight;
				imageContext.strokeRect(x,y,pixelWidth,pixelHeight);
				imageContext.fillRect(x,y,pixelWidth,pixelHeight);
			}
		}
	}
	trapsImage.src = imageCanvas.toDataURL("image/png");
	trapsImage.onload = drawSpiderWalk1;
	return;
}

function drawLiftedTile7()
{
	hiddenCanvas.width = pixelWidth;
	hiddenCanvas.height = pixelHeight;
	hiddenContext.fillStyle = "white";
	hiddenContext.fillRect(0,0,pixelWidth,pixelHeight);
	imageCanvas.width = pixelWidth;
	imageCanvas.height = pixelHeight;
	imageContext.fillStyle = "rgb(130,20,20)";
	imageContext.fillRect(0,0,pixelWidth,pixelHeight);
	imageContext.fillStyle = "indianred";
	imageContext.beginPath();
	imageContext.moveTo(0,pixelHeight);
	imageContext.lineTo(pixelWidth,0);
	imageContext.lineTo(0,0);
	imageContext.closePath();
	imageContext.fill();
	imageContext.fillStyle = "firebrick";
	imageContext.fillRect(2,2,pixelWidth-4,pixelHeight-4);
	imageContext.strokeStyle = "midnightblue";
	imageContext.fillStyle = "firebrick";
	imageContext.beginPath();
	imageContext.moveTo(10,18);
	imageContext.lineTo(10,6);
	var r, theta;
	imageContext.moveTo(7,6);
	for (var deg = 0; deg < 450; deg += 10)
	{
		theta = Math.PI*(deg-90)/180;
		r = 3*Math.pow(deg/450,0.75);
		imageContext.arc(7,6,r,theta,theta + Math.PI/18);
	}
	imageContext.moveTo(10,6);
	for (var deg = 0; deg < 450; deg += 10)
	{
		theta = Math.PI*(deg-180)/180;
		r = 3*Math.pow((450-deg)/450,0.75);
		imageContext.arc(13,6,r,theta,theta + Math.PI/18);
	}
	imageContext.stroke();
	liftedTileImages[6].src = imageCanvas.toDataURL("image/png");
	liftedTileImages[6].onload = function() {
		imageCanvas.width = 0;
		imageCanvas.height = 0;
		hiddenCanvas.width = 0;
		hiddenCanvas.height = 0;
		drawMazeImage();
	}
}

function drawTile7()
{
	imageCanvas.width = pixelWidth;
	imageCanvas.height = pixelHeight;
	imageContext.fillStyle = "peru";
	imageContext.fillRect(0,0,pixelWidth,pixelHeight);
	imageContext.fillStyle = "moccasin";
	imageContext.beginPath();
	imageContext.moveTo(0,pixelHeight);
	imageContext.lineTo(pixelWidth,0);
	imageContext.lineTo(0,0);
	imageContext.closePath();
	imageContext.fill();
	var gradient = imageContext.createLinearGradient(0,0,pixelWidth,pixelHeight);
	gradient.addColorStop(0,"wheat");
	gradient.addColorStop(1,"sandybrown");
	imageContext.fillStyle = gradient;
	imageContext.fillRect(2,2,pixelWidth-4,pixelHeight-4);
	imageContext.fillStyle = "rgba(160,82,45," + tileOpacity + ")";
	imageContext.strokeStyle = "rgba(160,82,45," + tileOpacity + ")";
	imageContext.beginPath();
	imageContext.moveTo(10,18);
	imageContext.lineTo(10,6);
	var r, theta;
	imageContext.moveTo(7,6);
	for (var deg = 0; deg < 450; deg += 10)
	{
		theta = Math.PI*(deg-90)/180;
		r = 3*Math.pow(deg/450,0.75);
		imageContext.arc(7,6,r,theta,theta + Math.PI/18);
	}
	imageContext.moveTo(10,6);
	for (var deg = 0; deg < 450; deg += 10)
	{
		theta = Math.PI*(deg-180)/180;
		r = 3*Math.pow((450-deg)/450,0.75);
		imageContext.arc(13,6,r,theta,theta + Math.PI/18);
	}
	imageContext.stroke();
	tileImages[6].src = imageCanvas.toDataURL("image/png");
	tileImages[6].onload = drawLiftedTile7;
}

function drawLiftedTile6()
{
	hiddenCanvas.width = pixelWidth;
	hiddenCanvas.height = pixelHeight;
	hiddenContext.fillStyle = "white";
	hiddenContext.fillRect(0,0,pixelWidth,pixelHeight);
	imageCanvas.width = pixelWidth;
	imageCanvas.height = pixelHeight;
	imageContext.fillStyle = "rgb(130,20,20)";
	imageContext.fillRect(0,0,pixelWidth,pixelHeight);
	imageContext.fillStyle = "indianred";
	imageContext.beginPath();
	imageContext.moveTo(0,pixelHeight);
	imageContext.lineTo(pixelWidth,0);
	imageContext.lineTo(0,0);
	imageContext.closePath();
	imageContext.fill();
	imageContext.fillStyle = "firebrick";
	imageContext.fillRect(2,2,pixelWidth-4,pixelHeight-4);
	imageContext.strokeStyle = "midnightblue";
	imageContext.fillStyle = "midnightblue";
	imageContext.fillRect(9,14,2,6);
	imageContext.fillRect(4,14,2,6);
	imageContext.fillRect(14,14,2,6);
	imageContext.beginPath();
	imageContext.moveTo(8,14);
	imageContext.beginPath();
	imageContext.lineTo(12,14);
	imageContext.lineTo(10,10);
	imageContext.lineTo(8,14);
	imageContext.closePath();
	imageContext.fill();
	imageContext.beginPath();
	imageContext.moveTo(3,14);
	imageContext.lineTo(7,14);
	imageContext.lineTo(5,10);
	imageContext.lineTo(3,14);
	imageContext.closePath();
	imageContext.fill();
	imageContext.beginPath();
	imageContext.moveTo(13,14);
	imageContext.lineTo(17,14);
	imageContext.lineTo(15,10);
	imageContext.lineTo(13,14);
	imageContext.closePath();
	imageContext.fill();
	imageContext.beginPath();
	imageContext.moveTo(8,11);
	imageContext.lineTo(12,11);
	imageContext.lineTo(10,7);
	imageContext.lineTo(8,11);
	imageContext.closePath();
	imageContext.fill();
	imageContext.beginPath();
	imageContext.moveTo(3,11);
	imageContext.lineTo(7,11);
	imageContext.lineTo(5,7);
	imageContext.lineTo(3,11);
	imageContext.closePath();
	imageContext.fill();
	imageContext.beginPath();
	imageContext.moveTo(13,11);
	imageContext.lineTo(17,11);
	imageContext.lineTo(15,7);
	imageContext.lineTo(13,11);
	imageContext.closePath();
	imageContext.fill();
	imageContext.beginPath();
	imageContext.moveTo(8,8);
	imageContext.lineTo(12,8);
	imageContext.lineTo(10,4);
	imageContext.lineTo(8,8);
	imageContext.closePath();
	imageContext.fill();
	imageContext.fillRect(9,0,2,6);
	imageContext.beginPath();
	imageContext.moveTo(4,7);
	imageContext.lineTo(15,2);
	imageContext.lineTo(14,1);
	imageContext.lineTo(5,8);
	imageContext.lineTo(4,7);
	imageContext.moveTo(14,8);
	imageContext.moveTo(4,2);
	imageContext.lineTo(15,7);
	imageContext.lineTo(14,8);
	imageContext.lineTo(5,1);
	imageContext.lineTo(4,2);
	imageContext.stroke();
	liftedTileImages[5].src = imageCanvas.toDataURL("image/png");
	liftedTileImages[5].onload = drawTile7;
}

function drawTile6()
{
	imageCanvas.width = pixelWidth;
	imageCanvas.height = pixelHeight;
	imageContext.fillStyle = "peru";
	imageContext.fillRect(0,0,pixelWidth,pixelHeight);
	imageContext.fillStyle = "moccasin";
	imageContext.beginPath();
	imageContext.moveTo(0,pixelHeight);
	imageContext.lineTo(pixelWidth,0);
	imageContext.lineTo(0,0);
	imageContext.closePath();
	imageContext.fill();
	var gradient = imageContext.createLinearGradient(0,0,pixelWidth,pixelHeight);
	gradient.addColorStop(0,"wheat");
	gradient.addColorStop(1,"sandybrown");
	imageContext.fillStyle = gradient;
	imageContext.fillRect(2,2,pixelWidth-4,pixelHeight-4);
	imageContext.fillStyle = "rgba(160,82,45," + tileOpacity + ")";
	imageContext.strokeStyle = "rgba(160,82,45," + tileOpacity + ")";
	imageContext.fillRect(9,14,2,6);
	imageContext.fillRect(4,14,2,6);
	imageContext.fillRect(14,14,2,6);
	imageContext.beginPath();
	imageContext.moveTo(8,14);
	imageContext.lineTo(12,14);
	imageContext.lineTo(10,10);
	imageContext.lineTo(8,14);
	imageContext.closePath();
	imageContext.fill();
	imageContext.beginPath();
	imageContext.moveTo(3,14);
	imageContext.lineTo(7,14);
	imageContext.lineTo(5,10);
	imageContext.lineTo(3,14);
	imageContext.closePath();
	imageContext.fill();
	imageContext.beginPath();
	imageContext.moveTo(13,14);
	imageContext.lineTo(17,14);
	imageContext.lineTo(15,10);
	imageContext.lineTo(13,14);
	imageContext.closePath();
	imageContext.fill();
	imageContext.beginPath();
	imageContext.moveTo(8,11);
	imageContext.lineTo(12,11);
	imageContext.lineTo(10,7);
	imageContext.lineTo(8,11);
	imageContext.closePath();
	imageContext.fill();
	imageContext.beginPath();
	imageContext.moveTo(3,11);
	imageContext.lineTo(7,11);
	imageContext.lineTo(5,7);
	imageContext.lineTo(3,11);
	imageContext.closePath();
	imageContext.fill();
	imageContext.beginPath();
	imageContext.moveTo(13,11);
	imageContext.lineTo(17,11);
	imageContext.lineTo(15,7);
	imageContext.lineTo(13,11);
	imageContext.closePath();
	imageContext.fill();
	imageContext.beginPath();
	imageContext.moveTo(8,8);
	imageContext.lineTo(12,8);
	imageContext.lineTo(10,4);
	imageContext.lineTo(8,8);
	imageContext.closePath();
	imageContext.fill();
	imageContext.fillRect(9,0,2,6);
	imageContext.beginPath();
	imageContext.moveTo(4,7);
	imageContext.lineTo(15,2);
	imageContext.lineTo(14,1);
	imageContext.lineTo(5,8);
	imageContext.lineTo(4,7);
	imageContext.moveTo(14,8);
	imageContext.moveTo(4,2);
	imageContext.lineTo(15,7);
	imageContext.lineTo(14,8);
	imageContext.lineTo(5,1);
	imageContext.lineTo(4,2);
	imageContext.stroke();
	tileImages[5].src = imageCanvas.toDataURL("image/png");
	tileImages[5].onload = drawLiftedTile6;
}

function drawLiftedTile5()
{
	hiddenCanvas.width = pixelWidth;
	hiddenCanvas.height = pixelHeight;
	hiddenContext.fillStyle = "white";
	hiddenContext.fillRect(0,0,pixelWidth,pixelHeight);
	imageCanvas.width = pixelWidth;
	imageCanvas.height = pixelHeight;
	imageContext.fillStyle = "rgb(130,20,20)";
	imageContext.fillRect(0,0,pixelWidth,pixelHeight);
	imageContext.fillStyle = "indianred";
	imageContext.beginPath();
	imageContext.moveTo(0,pixelHeight);
	imageContext.lineTo(pixelWidth,0);
	imageContext.lineTo(0,0);
	imageContext.closePath();
	imageContext.fill();
	imageContext.fillStyle = "firebrick";
	imageContext.fillRect(2,2,pixelWidth-4,pixelHeight-4);
	imageContext.strokeStyle = "midnightblue";
	imageContext.fillStyle = "midnightblue";
	imageContext.beginPath();
	imageContext.moveTo(10,9);
	imageContext.bezierCurveTo(13,7,16,1,10,1);
	imageContext.moveTo(10,9);
	imageContext.bezierCurveTo(7,7,4,1,10,1);
	imageContext.moveTo(10,9);
	imageContext.bezierCurveTo(12,7,16,1,10,1);
	imageContext.moveTo(10,9);
	imageContext.bezierCurveTo(8,7,4,1,10,1);
	imageContext.stroke();
	imageContext.beginPath();
	imageContext.moveTo(10,9);
	imageContext.lineTo(16,7);
	imageContext.lineTo(16,11);
	imageContext.lineTo(10,9);
	imageContext.closePath();
	imageContext.fill();
	imageContext.beginPath();
	imageContext.moveTo(10,9);
	imageContext.lineTo(4,7);
	imageContext.lineTo(4,11);
	imageContext.lineTo(10,9);
	imageContext.closePath();
	imageContext.fill();
	imageContext.beginPath();
	imageContext.moveTo(10,9);
	imageContext.lineTo(8,19);
	imageContext.lineTo(12,19);
	imageContext.lineTo(10,9);
	imageContext.closePath();
	imageContext.fill();
	liftedTileImages[4].src = imageCanvas.toDataURL("image/png");
	liftedTileImages[4].onload = drawTile6;
}

function drawTile5()
{
	imageCanvas.width = pixelWidth;
	imageCanvas.height = pixelHeight;
	imageContext.fillStyle = "peru";
	imageContext.fillRect(0,0,pixelWidth,pixelHeight);
	imageContext.fillStyle = "moccasin";
	imageContext.beginPath();
	imageContext.moveTo(0,pixelHeight);
	imageContext.lineTo(pixelWidth,0);
	imageContext.lineTo(0,0);
	imageContext.closePath();
	imageContext.fill();
	var gradient = imageContext.createLinearGradient(0,0,pixelWidth,pixelHeight);
	gradient.addColorStop(0,"wheat");
	gradient.addColorStop(1,"sandybrown");
	imageContext.fillStyle = gradient;
	imageContext.fillRect(2,2,pixelWidth-4,pixelHeight-4);
	imageContext.fillStyle = "rgba(160,82,45," + tileOpacity + ")";
	imageContext.strokeStyle = "rgba(160,82,45," + tileOpacity + ")";
	imageContext.beginPath();
	imageContext.moveTo(10,9);
	imageContext.bezierCurveTo(13,7,16,1,10,1);
	imageContext.moveTo(10,9);
	imageContext.bezierCurveTo(7,7,4,1,10,1);
	imageContext.moveTo(10,9);
	imageContext.bezierCurveTo(12,7,16,1,10,1);
	imageContext.moveTo(10,9);
	imageContext.bezierCurveTo(8,7,4,1,10,1);
	imageContext.stroke();
	imageContext.beginPath();
	imageContext.moveTo(10,9);
	imageContext.lineTo(16,7);
	imageContext.lineTo(16,11);
	imageContext.lineTo(10,9);
	imageContext.closePath();
	imageContext.fill();
	imageContext.beginPath();
	imageContext.moveTo(10,9);
	imageContext.lineTo(4,7);
	imageContext.lineTo(4,11);
	imageContext.lineTo(10,9);
	imageContext.closePath();
	imageContext.fill();
	imageContext.beginPath();
	imageContext.moveTo(10,9);
	imageContext.lineTo(8,19);
	imageContext.lineTo(12,19);
	imageContext.lineTo(10,9);
	imageContext.closePath();
	imageContext.fill();
	tileImages[4].src = imageCanvas.toDataURL("image/png");
	tileImages[4].onload = drawLiftedTile5;
}

function drawLiftedTile4()
{
	hiddenCanvas.width = pixelWidth;
	hiddenCanvas.height = pixelHeight;
	hiddenContext.fillStyle = "white";
	hiddenContext.fillRect(0,0,pixelWidth,pixelHeight);
	imageCanvas.width = pixelWidth;
	imageCanvas.height = pixelHeight;
	imageContext.fillStyle = "rgb(130,20,20)";
	imageContext.fillRect(0,0,pixelWidth,pixelHeight);
	imageContext.fillStyle = "indianred";
	imageContext.beginPath();
	imageContext.moveTo(0,pixelHeight);
	imageContext.lineTo(pixelWidth,0);
	imageContext.lineTo(0,0);
	imageContext.closePath();
	imageContext.fill();
	imageContext.fillStyle = "firebrick";
	imageContext.fillRect(2,2,pixelWidth-4,pixelHeight-4);
	imageContext.strokeStyle = "midnightblue";
	imageContext.fillStyle = "firebrick";
	imageContext.beginPath();
	imageContext.moveTo(10,18);
	imageContext.lineTo(10,10);
	imageContext.bezierCurveTo(10,2,10,2,4,2);
	imageContext.stroke();
	imageContext.moveTo(10,14);
	imageContext.bezierCurveTo(10,16,10,12,16,12);
	imageContext.moveTo(10,11);
	imageContext.bezierCurveTo(10,13,10,9,16,9);
	imageContext.moveTo(10,14);
	imageContext.bezierCurveTo(10,16,10,12,4,12);
	imageContext.moveTo(10,11);
	imageContext.bezierCurveTo(10,13,10,9,4,9);
	imageContext.stroke();
	liftedTileImages[3].src = imageCanvas.toDataURL("image/png");
	liftedTileImages[3].onload = drawTile5;
}

function drawTile4()
{
	imageCanvas.width = pixelWidth;
	imageCanvas.height = pixelHeight;
	imageContext.fillStyle = "peru";
	imageContext.fillRect(0,0,pixelWidth,pixelHeight);
	imageContext.fillStyle = "moccasin";
	imageContext.beginPath();
	imageContext.moveTo(0,pixelHeight);
	imageContext.lineTo(pixelWidth,0);
	imageContext.lineTo(0,0);
	imageContext.closePath();
	imageContext.fill();
	var gradient = imageContext.createLinearGradient(0,0,pixelWidth,pixelHeight);
	gradient.addColorStop(0,"wheat");
	gradient.addColorStop(1,"sandybrown");
	imageContext.fillStyle = gradient;
	imageContext.fillRect(2,2,pixelWidth-4,pixelHeight-4);
	imageContext.fillStyle = "rgba(160,82,45," + tileOpacity + ")";
	imageContext.strokeStyle = "rgba(160,82,45," + tileOpacity + ")";
	imageContext.beginPath();
	imageContext.moveTo(10,18);
	imageContext.lineTo(10,10);
	imageContext.bezierCurveTo(10,2,10,2,4,2);
	imageContext.stroke();
	imageContext.moveTo(10,14);
	imageContext.bezierCurveTo(10,16,10,12,16,12);
	imageContext.moveTo(10,11);
	imageContext.bezierCurveTo(10,13,10,9,16,9);
	imageContext.moveTo(10,14);
	imageContext.bezierCurveTo(10,16,10,12,4,12);
	imageContext.moveTo(10,11);
	imageContext.bezierCurveTo(10,13,10,9,4,9);
	imageContext.stroke();
	tileImages[3].src = imageCanvas.toDataURL("image/png");
	tileImages[3].onload = drawLiftedTile4;
}

function drawLiftedTile3()
{
	hiddenCanvas.width = pixelWidth;
	hiddenCanvas.height = pixelHeight;
	hiddenContext.fillStyle = "white";
	hiddenContext.fillRect(0,0,pixelWidth,pixelHeight);
	imageCanvas.width = pixelWidth;
	imageCanvas.height = pixelHeight;
	imageContext.fillStyle = "rgb(130,20,20)";
	imageContext.fillRect(0,0,pixelWidth,pixelHeight);
	imageContext.fillStyle = "indianred";
	imageContext.beginPath();
	imageContext.moveTo(0,pixelHeight);
	imageContext.lineTo(pixelWidth,0);
	imageContext.lineTo(0,0);
	imageContext.closePath();
	imageContext.fill();
	imageContext.fillStyle = "firebrick";
	imageContext.fillRect(2,2,pixelWidth-4,pixelHeight-4);
	imageContext.strokeStyle = "midnightblue";
	imageContext.fillStyle = "firebrick";
	imageContext.beginPath();
	imageContext.lineTo(18,9);
	imageContext.bezierCurveTo(12,4,10,8,10,4);
	imageContext.bezierCurveTo(5,9,14,9,14,9);
	imageContext.moveTo(9,9);
	imageContext.lineTo(2,9);
	imageContext.lineTo(2,11);
	imageContext.bezierCurveTo(11,12,12,13,18,11);
	imageContext.stroke();
	liftedTileImages[2].src = imageCanvas.toDataURL("image/png");
	liftedTileImages[2].onload = drawTile4;
}

function drawTile3()
{
	imageCanvas.width = pixelWidth;
	imageCanvas.height = pixelHeight;
	imageContext.fillStyle = "peru";
	imageContext.fillRect(0,0,pixelWidth,pixelHeight);
	imageContext.fillStyle = "moccasin";
	imageContext.beginPath();
	imageContext.moveTo(0,pixelHeight);
	imageContext.lineTo(pixelWidth,0);
	imageContext.lineTo(0,0);
	imageContext.closePath();
	imageContext.fill();
	var gradient = imageContext.createLinearGradient(0,0,pixelWidth,pixelHeight);
	gradient.addColorStop(0,"wheat");
	gradient.addColorStop(1,"sandybrown");
	imageContext.fillStyle = gradient;
	imageContext.fillRect(2,2,pixelWidth-4,pixelHeight-4);
	imageContext.fillStyle = "rgba(160,82,45," + tileOpacity + ")";
	imageContext.strokeStyle = "rgba(160,82,45," + tileOpacity + ")";
	imageContext.beginPath();
	imageContext.moveTo(18,11);
	imageContext.lineTo(18,9);
	imageContext.bezierCurveTo(12,4,10,8,10,4);
	imageContext.bezierCurveTo(5,9,14,9,14,9);
	imageContext.moveTo(9,9);
	imageContext.lineTo(2,9);
	imageContext.lineTo(2,11);
	imageContext.bezierCurveTo(11,12,12,13,18,11);
	imageContext.stroke();
	tileImages[2].src = imageCanvas.toDataURL("image/png");
	tileImages[2].onload = drawLiftedTile3;
}

function drawLiftedTile2()
{
	hiddenCanvas.width = pixelWidth;
	hiddenCanvas.height = pixelHeight;
	hiddenContext.fillStyle = "white";
	hiddenContext.fillRect(0,0,pixelWidth,pixelHeight);
	imageCanvas.width = pixelWidth;
	imageCanvas.height = pixelHeight;
	imageContext.fillStyle = "rgb(130,20,20)";
	imageContext.fillRect(0,0,pixelWidth,pixelHeight);
	imageContext.fillStyle = "indianred";
	imageContext.beginPath();
	imageContext.moveTo(0,pixelHeight);
	imageContext.lineTo(pixelWidth,0);
	imageContext.lineTo(0,0);
	imageContext.closePath();
	imageContext.fill();
	imageContext.fillStyle = "firebrick";
	imageContext.fillRect(2,2,pixelWidth-4,pixelHeight-4);
	imageContext.strokeStyle = "midnightblue";
	imageContext.fillStyle = "midnightblue";
	imageContext.beginPath();
	imageContext.arc(12,8,2,0,2*Math.PI);
	imageContext.closePath();
	imageContext.fill();
	imageContext.strokeStyle = "midnightblue";
	imageContext.beginPath();
	imageContext.moveTo(6,8);
	imageContext.bezierCurveTo(6,8,12,4,15,6);
	//imageContext.lineTo(18,10);
	imageContext.bezierCurveTo(15,6,17,10,18,9);
	imageContext.bezierCurveTo(13,10,12,12,6,8);
	imageContext.stroke();
	imageContext.fillRect(2,7,4,2);
	imageContext.beginPath();
	imageContext.moveTo(2,4);
	imageContext.lineTo(5,4);
	imageContext.bezierCurveTo(5,4,10,0,18,4);
	imageContext.stroke();
	imageContext.moveTo(6,15);
	var r, theta;
	for (var deg = 0; deg < 450; deg += 20)
	{
		theta = (180-deg)*Math.PI/180;
		r = 5*deg/630;
		imageContext.arc(6,15,r,theta,theta+Math.PI/9);
	}
	imageContext.moveTo(6,19);
	imageContext.bezierCurveTo(10,18,12,13,13,11);
	imageContext.bezierCurveTo(12,14,10,19,6,19);
	imageContext.stroke();
	imageContext.fillRect(14,10,2,4);
	imageContext.fillRect(15,14,1,3);
	liftedTileImages[1].src = imageCanvas.toDataURL("image/png");
	liftedTileImages[1].onload = drawTile3;
}

function drawTile2()
{
	imageCanvas.width = pixelWidth;
	imageCanvas.height = pixelHeight;
	imageContext.fillStyle = "peru";
	imageContext.fillRect(0,0,pixelWidth,pixelHeight);
	imageContext.fillStyle = "moccasin";
	imageContext.beginPath();
	imageContext.moveTo(0,pixelHeight);
	imageContext.lineTo(pixelWidth,0);
	imageContext.lineTo(0,0);
	imageContext.closePath();
	imageContext.fill();
	var gradient = imageContext.createLinearGradient(0,0,pixelWidth,pixelHeight);
	gradient.addColorStop(0,"wheat");
	gradient.addColorStop(1,"sandybrown");
	imageContext.fillStyle = gradient;
	imageContext.fillRect(2,2,pixelWidth-4,pixelHeight-4);
	imageContext.fillStyle = "rgba(160,82,45," + tileOpacity + ")";
	imageContext.strokeStyle = "rgba(160,82,45," + tileOpacity + ")";
	imageContext.beginPath();
	imageContext.arc(12,8,2,0,2*Math.PI);
	imageContext.closePath();
	imageContext.fill();
	//imageContext.strokeStyle = "rgba(160,82,45,0.5)";
	imageContext.beginPath();
	imageContext.moveTo(6,8);
	imageContext.bezierCurveTo(6,8,12,4,15,6);
	//imageContext.lineTo(18,10);
	imageContext.bezierCurveTo(15,6,17,10,18,9);
	imageContext.bezierCurveTo(13,10,12,12,6,8);
	imageContext.stroke();
	imageContext.fillRect(2,7,4,2);
	imageContext.beginPath();
	imageContext.moveTo(2,4);
	imageContext.lineTo(5,4);
	imageContext.bezierCurveTo(5,4,10,0,18,4);
	imageContext.stroke();
	imageContext.moveTo(6,15);
	var r, theta;
	for (var deg = 0; deg < 450; deg += 20)
	{
		theta = (180-deg)*Math.PI/180;
		r = 5*deg/630;
		imageContext.arc(6,15,r,theta,theta+Math.PI/9);
	}
	imageContext.moveTo(6,19);
	imageContext.bezierCurveTo(10,18,12,13,13,11);
	imageContext.bezierCurveTo(12,14,10,19,6,19);
	imageContext.stroke();
	imageContext.fillRect(14,10,2,4);
	imageContext.fillRect(15,14,1,3);
	tileImages[1].src = imageCanvas.toDataURL("image/png");
	tileImages[1].onload = drawLiftedTile2;
}

function drawLiftedTile1()
{
	hiddenCanvas.width = pixelWidth;
	hiddenCanvas.height = pixelHeight;
	hiddenContext.fillStyle = "white";
	hiddenContext.fillRect(0,0,pixelWidth,pixelHeight);
	imageCanvas.width = pixelWidth;
	imageCanvas.height = pixelHeight;
	imageContext.fillStyle = "rgb(130,20,20)";
	imageContext.fillRect(0,0,pixelWidth,pixelHeight);
	imageContext.fillStyle = "indianred";
	imageContext.beginPath();
	imageContext.moveTo(0,pixelHeight);
	imageContext.lineTo(pixelWidth,0);
	imageContext.lineTo(0,0);
	imageContext.closePath();
	imageContext.fill();
	imageContext.fillStyle = "firebrick";
	imageContext.fillRect(2,2,pixelWidth-4,pixelHeight-4);
	imageContext.strokeStyle = "midnightblue";
	imageContext.fillStyle = "firebrick";
	imageContext.beginPath();
	imageContext.moveTo(10,8);
	imageContext.lineTo(15,5);
	imageContext.lineTo(13,0);
	imageContext.lineTo(16,5);
	imageContext.lineTo(11,8);
	imageContext.moveTo(10,8);
	imageContext.lineTo(17,11);
	imageContext.lineTo(11,8);
	imageContext.moveTo(10,10);
	imageContext.lineTo(14,15);
	imageContext.lineTo(14,20);
	imageContext.lineTo(15,14);
	imageContext.lineTo(10,9);
	imageContext.moveTo(10,8);
	imageContext.lineTo(5,5);
	imageContext.lineTo(7,0);
	imageContext.lineTo(4,5);
	imageContext.lineTo(9,8);
	imageContext.moveTo(10,8);
	imageContext.lineTo(3,11);
	imageContext.lineTo(9,8);
	imageContext.moveTo(10,10);
	imageContext.lineTo(6,15);
	imageContext.lineTo(6,20);
	imageContext.lineTo(5,14);
	imageContext.lineTo(10,9);
	imageContext.stroke();
	imageContext.beginPath();
	imageContext.arc(10,4.5,2,0,2*Math.PI);
	imageContext.stroke();
	imageContext.beginPath();
	imageContext.arc(10,8,3,0,2*Math.PI);
	imageContext.fill();
	imageContext.stroke();
	imageContext.beginPath();
	imageContext.moveTo(13,8);
	imageContext.bezierCurveTo(14,12,14,16,10,16);
	imageContext.lineTo(10,11);
	imageContext.arc(10,8,3,0,Math.PI/2);
	imageContext.fill();
	imageContext.stroke();
	imageContext.beginPath();
	imageContext.moveTo(7,8);
	imageContext.bezierCurveTo(6,12,6,16,10,16);
	imageContext.lineTo(10,11);
	imageContext.arc(10,8,3,Math.PI/2,Math.PI);
	imageContext.fill();
	imageContext.stroke();
	liftedTileImages[0].src = imageCanvas.toDataURL("image/png");
	liftedTileImages[0].onload = drawTile2;
}

function drawTile1()
{
	hiddenCanvas.width = pixelWidth;
	hiddenCanvas.height = pixelHeight;
	hiddenContext.fillStyle = "white";
	hiddenContext.fillRect(0,0,pixelWidth,pixelHeight);
	imageCanvas.width = pixelWidth;
	imageCanvas.height = pixelHeight;
	imageContext.fillStyle = "peru";
	imageContext.fillRect(0,0,pixelWidth,pixelHeight);
	imageContext.fillStyle = "moccasin";
	imageContext.beginPath();
	imageContext.moveTo(0,pixelHeight);
	imageContext.lineTo(pixelWidth,0);
	imageContext.lineTo(0,0);
	imageContext.closePath();
	imageContext.fill();
	var gradient = imageContext.createLinearGradient(0,0,pixelWidth,pixelHeight);
	gradient.addColorStop(0,"wheat");
	gradient.addColorStop(1,"sandybrown");
	imageContext.fillStyle = gradient;
	imageContext.fillRect(2,2,pixelWidth-4,pixelHeight-4);
	imageContext.strokeStyle = "rgba(160,82,45," + tileOpacity + ")";
	imageContext.fillStyle = gradient;
	imageContext.beginPath();
	imageContext.moveTo(10,8);
	imageContext.lineTo(15,5);
	imageContext.lineTo(13,0);
	imageContext.lineTo(16,5);
	imageContext.lineTo(11,8);
	imageContext.moveTo(10,8);
	imageContext.lineTo(17,11);
	imageContext.lineTo(11,8);
	imageContext.moveTo(10,10);
	imageContext.lineTo(14,15);
	imageContext.lineTo(14,20);
	imageContext.lineTo(15,14);
	imageContext.lineTo(10,9);
	imageContext.moveTo(10,8);
	imageContext.lineTo(5,5);
	imageContext.lineTo(7,0);
	imageContext.lineTo(4,5);
	imageContext.lineTo(9,8);
	imageContext.moveTo(10,8);
	imageContext.lineTo(3,11);
	imageContext.lineTo(9,8);
	imageContext.moveTo(10,10);
	imageContext.lineTo(6,15);
	imageContext.lineTo(6,20);
	imageContext.lineTo(5,14);
	imageContext.lineTo(10,9);
	imageContext.stroke();
	imageContext.beginPath();
	imageContext.arc(10,4.5,2,0,2*Math.PI);
	imageContext.stroke();
	imageContext.beginPath();
	imageContext.arc(10,8,3,0,2*Math.PI);
	imageContext.fill();
	imageContext.stroke();
	imageContext.beginPath();
	imageContext.moveTo(13,8);
	imageContext.bezierCurveTo(14,12,14,16,10,16);
	imageContext.lineTo(10,11);
	imageContext.arc(10,8,3,0,Math.PI/2);
	imageContext.fill();
	imageContext.stroke();
	imageContext.beginPath();
	imageContext.moveTo(7,8);
	imageContext.bezierCurveTo(6,12,6,16,10,16);
	imageContext.lineTo(10,11);
	imageContext.arc(10,8,3,Math.PI/2,Math.PI);
	imageContext.fill();
	imageContext.stroke();
	tileImages[0].src = imageCanvas.toDataURL("image/png");
	tileImages[0].onload = drawLiftedTile1;
}

function drawShadowImage()
{
	hiddenCanvas.width = mazeImage.width;
	hiddenCanvas.height = mazeImage.height;
	hiddenContext.fillStyle = "white";
	hiddenContext.fillRect(0,0,mazeImage.width,mazeImage.height);
	imageCanvas.width = mazeImage.width;
	imageCanvas.height = mazeImage.height;
	imageContext.strokeStyle = "sienna";
	imageContext.fillStyle = "rgba(0,0,0,0.5)";
	var x, y;
	var u = Math.round(pixelWidth/4);
	var w = Math.round(pixelHeight/4);
	for (var i = 0; i < grid.length; i++)
	{
		for (var j = 0; j < grid[i].length; j++)
		{
			if (grid[i][j] == -1)
			{
				imageContext.save();
				imageContext.globalCompositeOperation = "destination-out";
				imageContext.beginPath();
				x = i*pixelWidth + blankSpaceWidth;
				y = j*pixelHeight + blankSpaceHeight;
				imageContext.moveTo(x,y+pixelHeight);
				imageContext.lineTo(x+1.5*u,y+1.5*w+pixelHeight);
				imageContext.lineTo(x+1.5*u+pixelWidth,y+1.5*w+pixelHeight);
				imageContext.lineTo(x+1.5*u+pixelWidth,y+1.5*w);
				imageContext.lineTo(x+pixelWidth,y);
				imageContext.closePath();
				imageContext.fill();
				imageContext.restore();
				imageContext.fillStyle = "rgba(0,0,0,0.5)";
				imageContext.beginPath();
				imageContext.moveTo(x,y+pixelHeight);
				imageContext.lineTo(x+1.5*u,y+1.5*w+pixelHeight);
				imageContext.lineTo(x+1.5*u+pixelWidth,y+1.5*w+pixelHeight);
				imageContext.lineTo(x+1.5*u+pixelWidth,y+1.5*w);
				imageContext.lineTo(x+pixelWidth,y);
				imageContext.closePath();
				imageContext.fill();
			}
		}
	}
	for (var i = 0; i < grid.length; i++)
	{
		for (var j = 0; j < grid[i].length; j++)
		{
			if (grid[i][j] == -1)
			{
				imageContext.fillStyle = "maroon";
				imageContext.beginPath();
				x = i*pixelWidth + blankSpaceWidth;
				y = j*pixelHeight + blankSpaceHeight;
				imageContext.moveTo(x-u,y-w+pixelHeight);
				imageContext.lineTo(x,y+pixelHeight);
				imageContext.lineTo(x+pixelWidth,y+pixelHeight);
				imageContext.lineTo(x+pixelWidth,y);
				imageContext.lineTo(x-u+pixelWidth,y-w);
				imageContext.closePath();
				imageContext.fill();
				imageContext.fillStyle = "firebrick";
				//imageContext.fillRect(i*pixelWidth+blankSpaceWidth,j*pixelHeight+blankSpaceHeight,pixelWidth,pixelHeight);
				//imageContext.fillRect(x-u,y-w,pixelWidth,pixelHeight);
				//imageContext.strokeRect(x-u,y-w,pixelWidth,pixelHeight);
				imageContext.drawImage(liftedTileImages[(i*j + i + j)%7],x-u,y-w);
			}
		}
	}
	shadowImage.src = imageCanvas.toDataURL("image/png");
	shadowImage.onload = drawTrapsImage;
	return;
}

function drawMazeImage()
{
	hiddenCanvas.width = mazeImage.width;
	hiddenCanvas.height = mazeImage.height;
	hiddenContext.fillStyle = "white";
	hiddenContext.fillRect(0,0,mazeImage.width,mazeImage.height);
	imageCanvas.width = mazeImage.width;
	imageCanvas.height = mazeImage.height;
	imageContext.strokeStyle = "black";
	imageContext.fillStyle = "black";
	for (var i = 0; i < grid.length; i++)
	{
		for (var j = 0; j < grid[i].length; j++)
		{
			//imageContext.strokeRect(i*pixelWidth+blankSpaceWidth,j*pixelHeight+blankSpaceHeight,pixelWidth,pixelHeight);
			if (!grid[i][j])
			{
				imageContext.drawImage(tileImages[(i*j + i + j)%7],i*pixelWidth+blankSpaceWidth,j*pixelHeight+blankSpaceHeight);
			}
		}
	}
	imageContext.fillRect(0,0,blankSpaceWidth,mazeImage.height);
	imageContext.fillRect(0,0,mazeImage.width,blankSpaceHeight);
	imageContext.fillRect(mazeImage.width-blankSpaceWidth,0,blankSpaceWidth,mazeImage.height);
	imageContext.fillRect(0,mazeImage.height-blankSpaceHeight,mazeImage.width,blankSpaceHeight);
	mazeImage.src = imageCanvas.toDataURL("image/png");
	mazeImage.onload = drawShadowImage;
	return;
}

function createTrap()
{
	var test = 1;
	var i, j;
	while (test)
	{
		i = Math.floor(Math.random()*grid.length);
		j = Math.floor(Math.random()*grid[i].length);
		test = grid[i][j];
	}
	grid[i][j] = -2;
	return;
}

function fillMaze(i,j)
{
	if (checkedGrid[i][j]) {return;}
	checkedGrid[i][j] = 1;
	grid[i][j] = 0;
	var cutoff = 0.85;
	if (i-1 >= 0)
	{
		if (Math.random() < cutoff)
		{
			fillMaze(i-1,j);
		} else {
			checkedGrid[i-1][j] = 1;
		}
	}
	if (j-1 >= 0)
	{
		if (Math.random() < cutoff)
		{
			fillMaze(i,j-1);
		} else {
			checkedGrid[i][j-1] = 1;
		}
	}
	if (j+1 < grid[i].length)
	{
		if (Math.random() < cutoff)
		{
			fillMaze(i,j+1);
		} else {
			checkedGrid[i][j+1] = 1;
		}
	}
	if (i+1 < grid.length)
	{
		if (Math.random() < cutoff)
		{
			fillMaze(i+1,j);
		} else {
			checkedGrid[i+1][j] = 1;
		}
	}
	return;
}

function drawBallImage()
{
	var bR = Math.round(pixelWidth/2);
	hiddenCanvas.width = canvasWidth;
	hiddenCanvas.height = canvasHeight;
	imageCanvas.width = pixelWidth;
	imageCanvas.height = pixelHeight;
	var gradient = imageContext.createRadialGradient(Math.round(bR/2),Math.round(bR/2),0,bR,bR,Math.round(1.6*bR));
	gradient.addColorStop(0,"cyan");
	gradient.addColorStop(1,"mediumblue");
	gradient.addColorStop(0.68,"deepskyblue");
	gradient.addColorStop(0.2,"blue");
	imageContext.fillStyle = gradient;
	imageContext.arc(bR,bR,bR,0,2*Math.PI);
	imageContext.fill();
	ballImage.src = imageCanvas.toDataURL("image/png");
	ballImage.onload = drawTile1;
	return;
}

function initializeGrid()
{
	grid = new Array(numberOfPixelsInGrid);
	checkedGrid = new Array(numberOfPixelsInGrid);
	for (var i = 0; i < numberOfPixelsInGrid; i++)
	{
		grid[i] = new Array(numberOfPixelsInGrid);
		checkedGrid[i] = new Array(numberOfPixelsInGrid);
		for (var j = 0; j < numberOfPixelsInGrid; j++)
		{
			grid[i][j] = -1;
			checkedGrid[i][j] = 0;
		}
	}
	fillMaze(Math.floor(Math.random()*numberOfPixelsInGrid),Math.floor(Math.random()*numberOfPixelsInGrid));
	var counter = 0;
	for (var i = 0; i < grid.length; i++)
	{
		for (var j = 0; j < grid[i].length; j++)
		{
			if (grid[i][j] == 0) {counter++;}
		}
	}
	if (counter < minimumNumberOfTiles)
	{
		initializeGrid();
		return;
	}
	for (var i = 0; i < numberOfTraps; i++)
	{
		createTrap();
	}
	var test = 1;
	while (test)
	{
		playerI = Math.floor(Math.random()*grid.length);
		playerJ = Math.floor(Math.random()*grid[playerI].length);
		test = grid[playerI][playerJ];
	}
	playerDirection = 0;
	for (var i = 0; i < numberOfMonsters; i++)
	{
		test = 0;
		while (!test)
		{
			monsterI[i] = Math.floor(Math.random()*grid.length);
			monsterJ[i] = Math.floor(Math.random()*grid[playerI].length);
			test = (grid[monsterI[i]][monsterJ[i]] == 0 && (Math.pow(monsterI[i]-playerI,2) + Math.pow(monsterJ[i]-playerJ,2)) > monsterSightRadius*monsterSightRadius);
		}
		monsterIsAsleep[i] = 1;
		monsterIsAlive[i] = 1;
		test = 0;
		while (!test)
		{
			monsterDirection[i] = Math.floor(Math.random()*4);
			switch (monsterDirection[i])
			{
				case 0:
					test = (monsterI[i] > 0 && grid[monsterI[i]-1][monsterJ[i]] != -1);
					break;
				case 1:
					test = (monsterI[i]+1 < grid.length && grid[monsterI[i]+1][monsterJ[i]] != -1);
					break;
				case 2:
					test = (monsterJ[i] > 0 && grid[monsterI[i]][monsterJ[i]-1] != -1);
					break;
				case 3:
					test = (monsterJ[i]+1 < grid[monsterI[i]].length && grid[monsterI[i]][monsterJ[i]+1] != -1);
					break;
			}
		}
		monsterWalkIndex[i] = 4;
	}
	for (var i = 0; i < monsterImages.length; i++)
	{
		monsterImages[i] = new Array(numberOfMonsterFrames);
		for (var j = 0; j < numberOfMonsterFrames; j++)
		{
			monsterImages[i][j] = new Image(pixelWidth,pixelHeight);
		}
	}
	drawBallImage();
	return;
}

function walk(currentI,currentJ,newI,newJ,frame)
{
	playerWalkIndex = frame-1;
	if (frame > 4)
	{
		playerWalkIndex = 0;
		if (grid[playerI][playerJ] == -2)
		{
			gameOverSequence();
			return;
		}
		for (var i = 0; i < numberOfMonsters; i++)
		{
			if (playerI == monsterI[i] && playerJ == monsterJ[i])
			{
				gameOverSequence();
				return;
			}
		}
		setTimeout( function() {
			isWalking = 0;
			if (!keyReleased || couldIGetAKeyInEdgewise)
			{
				arrowKey(lastkeycode);
				return;
			};
			renderMaze();
		}, playerTimer);
		return;
	}
	playerI = (newI - currentI)*frame/4 + currentI;
	playerJ = (newJ - currentJ)*frame/4 + currentJ;
	renderMaze();
	(function(cI,cJ,nI,nJ,f) {
		setTimeout( function() {
			walk(cI,cJ,nI,nJ,f+1);
		}, playerTimer);
	})(currentI,currentJ,newI,newJ,frame);
	return;
}

function tiltHandler(beta,gamma)
{
	//Simulates an arrow key event.
	var keycode;	
	if (Math.abs(beta) < 5 && Math.abs(gamma) < 5)
	{
		keyReleased = 1;
		return;
	}
	if (Math.abs(beta) < Math.abs(gamma))
	{
		if (gamma < 0)
		{
			keycode = 37; //left
		} else {
			keycode = 39; //right
		}
	} else {
		if (beta > 0)
		{
			keycode = 40; //down
		} else {
			keycode = 38; //up
		}
	}
	/*
	if (window.screen.orientation.type === "landscape-primary")
	{
		if (Math.abs(beta) < Math.abs(gamma))
		{
			if (gamma < 0)
			{
				keycode = 37; //left
			} else {
				keycode = 39; //right
			}
		} else {
			if (beta > 0)
			{
				keycode = 40; //down
			} else {
				keycode = 38; //up
			}
		}
	} else if (window.screen.orientation.type === "portrait-primary") {
		if (Math.abs(beta) < Math.abs(gamma))
		{
			if (gamma < 0)
			{
				keycode = 38; //up
			} else {
				keycode = 40; //down
			}
		} else {
			if (beta > 0)
			{
				keycode = 37; //left
			} else {
				keycode = 39; //right
			}
		}
	} else if (window.screen.orientation.type === "portrait-secondary") {
		if (Math.abs(beta) < Math.abs(gamma))
		{
			if (gamma < 0)
			{
				keycode = 40; //down
			} else {
				keycode = 38; //up
			}
		} else {
			if (beta > 0)
			{
				keycode = 39; //right
			} else {
				keycode = 37; //left
			}
		}
	} else if (window.screen.orientation.type === "landscape-secondary") {
		if (Math.abs(beta) < Math.abs(gamma))
		{
			if (gamma < 0)
			{
				keycode = 39; //right
			} else {
				keycode = 37; //left
		} else {
			if (beta > 0)
			{
				keycode = 38; //up
			} else {
				keycode = 40; //down
			}
		}
	}
	*/
	arrowKey(keycode);
	return;
}

function arrowKey(keycode)
{
	if (gameOver) {return;}
	if (isWalking)
	{
		if (lastkeycode != keycode) {couldIGetAKeyInEdgewise = 1;}
		lastkeycode = keycode;
		return;
	}
	//keyReleased = 0;
	keyReleased = 0;
	couldIGetAKeyInEdgewise = 0;
	lastkeycode = keycode;
	var newI = playerI;
	var newJ = playerJ;
	var newDirection = playerDirection;
	switch (keycode)
	{
		case 37: //left
			newI = playerI - 1;
			newDirection = 0;
			break;
		case 38: //up
			newJ = playerJ - 1;
			break;
		case 39: //right
			newI = playerI + 1;
			newDirection = 1;
			break;
		case 40: //down
			newJ = playerJ + 1;
			break;
	}
	if (newI < grid.length && newI >= 0 && newJ < grid[newI].length && newJ >= 0 && grid[newI][newJ] != -1)
	{
		playerDirection = newDirection;
		isWalking = 1;
		walk(playerI,playerJ,newI,newJ,1);
	}
	return;
}

function gameOverSequence()
{
	gameOver = 1;
	textContext.fillStyle = "gold";
	textContext.font = "20px Georgia";
	textContext.fillRect(Math.round((canvasWidth-pixelWidth)/2)-3*pixelWidth,Math.round(canvasHeight/2)-0.85*pixelHeight,7*pixelWidth,1.7*pixelHeight);
	textContext.fillStyle = "indigo";
	textContext.fillText("GAME OVER",Math.round(canvasWidth/2)-3*pixelWidth,Math.round(canvasHeight/2)+0.35*pixelHeight);
	return;
}

function victorySequence()
{
	gameOver = 1;
	textContext.fillStyle = "gold";
	textContext.font = "20px Georgia";
	textContext.fillRect(Math.round((canvasWidth-pixelWidth)/2)-2.5*pixelWidth,Math.round(canvasHeight/2)-0.85*pixelHeight,6*pixelWidth,1.7*pixelHeight);
	textContext.fillStyle = "indigo";
	textContext.fillText("YOU WIN!",Math.round(canvasWidth/2)-2.5*pixelWidth,Math.round(canvasHeight/2)+0.35*pixelHeight);
	return;
}

function play()
{
	initializeGrid();
	return;
}

</script>
</body>
</html>